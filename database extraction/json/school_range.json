{
	"jobName": "school_range_count",
	"source": {
		"dbType": "mongodb",
		"host": "localhost",
		"port": "27017",
		"dbName": "prod_log",
		"collection": "prod_log"
	},
	"destination": {
		"dbType": "mongodb",
		"host": "localhost",
		"port": "27017",
		"dbName": "dest_prod_log",
		"collection": "dest_prod_log"
	},
	"runTimeArguments": [
	],
	"startDate": 1,
	"endDate": 1,
	"query": [
		{"$group":{"_id":"$school_name","count":{"$sum":1}}},
		{ "$project": { 
            "range": { 
                "$switch": { 
                    "branches": [ 
                        { 
                            "case": { "$lte": [ "$count", 50 ] }, 
                            "then": "0-50" 
                        }, 
                        { 
                            "case": { 
                                "$and": [ 
                                    { "$gt": [ "$count", 50 ] }, 
                                    { "$lte": [ "$count", 200 ] } 
                                ] 
                            }, 
                            "then": "50-200" 
                        }, 
                        { 
                            "case": { 
                                "$and": [ 
                                    { "$gt": [ "$count", 200 ] }, 
                                    { "$lte": [ "$count", 500 ] } 
                                ] 
                            }, 
                            "then": "200-500" 
                        },
                        { 
                            "case": { 
                                "$and": [ 
                                    { "$gt": [ "$count", 500 ] }, 
                                    { "$lte": [ "$count", 1000 ] } 
                                ] 
                            }, 
                            "then": "500-1000" 
                        },
                        { 
                            "case": { 
                                "$and": [ 
                                    { "$gt": [ "$count", 1000 ] }, 
                                    { "$lte": [ "$count", 2000 ] } 
                                ] 
                            }, 
                            "then": "1000-2000" 
                        } 
                    ], 
                    "default": ">2000" 
                } 
            } 
        }}, 
        { "$group": { 
            "_id": {"range":"$range"}, 
            "count": { "$sum": 1 } 
        }},
        {"$sort":{"count":-1}}
	],
	"additionalOutput": {
		"lastDate": "date"
	}
}